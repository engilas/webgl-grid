(this["webpackJsonpwebgl-test-ex2"]=this["webpackJsonpwebgl-test-ex2"]||[]).push([[0],{19:function(t,e,i){t.exports=i(26)},24:function(t,e,i){},26:function(t,e,i){"use strict";i.r(e);var r=i(1),n=i.n(r),s=i(9),a=i.n(s),o=(i(24),i(4)),h=i.n(o),l=i(7),u=i(6),c=i(10),d=i(2),g=i(3),f=function(){function t(e,i,r){Object(d.a)(this,t),this.gl=void 0,this.vsSource=void 0,this.fsSource=void 0,this.programId=void 0,this.gl=e,this.vsSource=i,this.fsSource=r,this.programId=this.gl.createProgram(),this.initShaderProgram()}return Object(g.a)(t,[{key:"use",value:function(){this.gl.useProgram(this.programId)}},{key:"setMat4",value:function(t,e){this.gl.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}},{key:"setVec3",value:function(t,e){this.gl.uniform3fv(this.getUniformLocation(t),e)}},{key:"getAttribLocation",value:function(t){var e=this.gl.getAttribLocation(this.programId,t);if(-1===e)throw new Error("No attrib with name "+t);return e}},{key:"getUniformLocation",value:function(t){var e=this.gl.getUniformLocation(this.programId,t);if(!e)throw new Error("No uniform with name "+t);return e}},{key:"initShaderProgram",value:function(){var t=this.loadShader(this.gl.VERTEX_SHADER,this.vsSource),e=this.loadShader(this.gl.FRAGMENT_SHADER,this.fsSource);if(this.gl.attachShader(this.programId,t),this.gl.attachShader(this.programId,e),this.gl.linkProgram(this.programId),!this.gl.getProgramParameter(this.programId,this.gl.LINK_STATUS))throw new Error("Unable to initialize the shader program: "+this.gl.getProgramInfoLog(this.programId))}},{key:"loadShader",value:function(t,e){var i=this.gl.createShader(t);if(!i)throw new Error("Shader loading failed");if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){var r=this.gl.getShaderInfoLog(i);throw this.gl.deleteShader(i),new Error("An error occurred compiling the shaders: "+r)}return i}}]),t}(),v=function(){function t(e,i){Object(d.a)(this,t),this.begin=void 0,this.end=void 0,this.gl=void 0,this.shader=void 0,this.buffer={},this.begin=[-1,0],this.end=[1,0],this.gl=e,this.shader=i,this.initBuffer()}return Object(g.a)(t,[{key:"draw",value:function(t,e){this.setupBuffer(),this.shader.use(),this.shader.setMat4("uModelViewMatrix",t),this.shader.setVec3("uColor",e);this.gl.drawArrays(this.gl.LINES,0,2)}},{key:"initBuffer",value:function(){var t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t);var e=[this.begin,this.end].flat();this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.buffer=t}},{key:"setupBuffer",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer);var t=this.gl.FLOAT,e=this.shader.getAttribLocation("aPos");this.gl.vertexAttribPointer(e,2,t,!1,0,0),this.gl.enableVertexAttribArray(e)}}]),t}(),m=i(0);function w(t,e){return 2*t/e-1}function b(t,e,i){return Math.min(Math.max(t,e),i)}var p=function(){function t(e,i,r,n,s,a){var o=this;Object(d.a)(this,t),this.width=void 0,this.height=void 0,this.center=[0,0],this.shader=null,this.isMouseDown=!1,this.startPos=[0,0],this.gl=void 0,this.line=void 0,this.scale=1,this.zoom=0,this.gl=e,this.width=r,this.height=n,i.addEventListener("mousedown",(function(t){return o.startMoving(t.clientX,t.clientY)})),i.addEventListener("mouseup",(function(t){return o.stopMoving()})),i.addEventListener("mousemove",(function(t){return o.move(t.clientX,t.clientY)})),i.addEventListener("wheel",(function(t){return o.onWheel(t)})),i.addEventListener("touchstart",(function(t){return o.startMoving(t.touches[0].clientX,t.touches[0].clientY)})),i.addEventListener("touchend",(function(t){return o.stopMoving()})),i.addEventListener("touchmove",(function(t){return o.move(t.touches[0].clientX,t.touches[0].clientY)})),this.shader=new f(this.gl,s,a),this.line=new v(this.gl,this.shader)}return Object(g.a)(t,[{key:"startMoving",value:function(t,e){this.isMouseDown=!0,this.startPos=[this.center[0]+t/this.scale,this.center[1]-e/this.scale]}},{key:"stopMoving",value:function(){this.isMouseDown=!1}},{key:"move",value:function(t,e){this.isMouseDown&&(this.center=[this.startPos[0]-t/this.scale,this.startPos[1]+e/this.scale],this.render())}},{key:"onWheel",value:function(t){this.zoom=b(this.zoom-.15*Math.sign(t.deltaY),-9,10.05),this.scale=Math.exp(this.zoom),this.render()}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.gl.viewport(0,0,t,e)}},{key:"render",value:function(){var t=this;if(this.shader){for(var e=[25e4],i=0;i<7;i++)e.push(e[e.length-1]/10);var r=e.sort().map((function(e){return t.getGridLines(e)})).flat(),n=m.b.create(),s=m.b.create();m.b.translate(n,n,[0,w(-this.center[1],this.height/this.scale)+1,0]),m.b.translate(s,s,[w(-this.center[0],this.width/this.scale)+1,0,0]),m.b.rotateZ(s,s,m.a.toRadian(90));var a=[r,[{line:this.line,color:[1,.3,.3],model:n}],[{line:this.line,color:[.3,1,.3],model:s}]].flat();this.drawScene(a)}}},{key:"drawScene",value:function(t){this.gl.clearColor(.2,.2,.2,1),this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);var e,i=Object(c.a)(t);try{for(i.s();!(e=i.n()).done;){var r=e.value,n=r.line,s=r.color,a=r.model;n.draw(a,s)}}catch(o){i.e(o)}finally{i.f()}}},{key:"getGridLines",value:function(t){var e=this;if(t*this.scale<=5)return[];var i=this.getLineColor(t);return[this.getXModels(t).map((function(t){return{line:e.line,color:i,model:t}})),this.getYModels(t).map((function(t){return{line:e.line,color:i,model:t}}))].flat()}},{key:"getLineColor",value:function(t){var e=Math.max(this.width,this.height)/2/this.scale,i=(.35-.2)*b(Math.min(t/(5*e)+.8,4*t/e),0,1)+.2;return Array(3).fill(i)}},{key:"getXModels",value:function(t){return this.getGridLineModels(t,this.height,this.center[1],(function(t){var e=m.b.create();return m.b.translate(e,e,[0,t,0]),e}))}},{key:"getYModels",value:function(t){return this.getGridLineModels(t,this.width,this.center[0],(function(t){var e=m.b.create();return m.b.translate(e,e,[t,0,0]),m.b.rotateZ(e,e,m.a.toRadian(90)),e}))}},{key:"getGridLineModels",value:function(t,e,i,r){for(var n=[],s=i-(e/=this.scale)/2,a=s+e,o=Math.floor(s/t)*t+t;o<a;)n.push(r(w(o-s,e))),o+=t;return n}}]),t}(),E=function(){var t=Object(l.a)(h.a.mark((function t(e){var i;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return i=t.sent,t.next=5,i.text();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),S=function(){var t=Object(r.useRef)(null),e=Object(r.useState)([window.innerWidth,window.innerHeight]),i=Object(u.a)(e,2),s=i[0],a=i[1],o=Object(r.useState)(null),c=Object(u.a)(o,2),d=c[0],g=c[1];return Object(r.useEffect)((function(){Object(l.a)(h.a.mark((function e(){var i,r,n,s,o,l,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.current,null!==(r=i.getContext("webgl"))){e.next=4;break}throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.");case 4:return e.next=6,Promise.all([E("shaders/app.vert"),E("shaders/app.frag")]);case 6:n=e.sent,s=Object(u.a)(n,2),o=s[0],l=s[1],c=new p(r,i,i.width,i.height,o,l),window.onresize=function(){a([window.innerWidth,window.innerHeight])},c.render(),g(c);case 14:case"end":return e.stop()}}),e)})))()}),[]),Object(r.useEffect)((function(){d&&(d.resize(s[0],s[1]),d.render())}),[d,s]),n.a.createElement("canvas",{ref:t,width:s[0],height:s[1],id:"glCanvas"})};a.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(S,null)),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.606c15ff.chunk.js.map